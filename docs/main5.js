import{G as l,a as c,D as S,e as u,f as p,c as w,g as A,B as C,h as L,P as M,i as x,j as E,k as P,l as D,m as B,W as R,n as T,A as O}from"./three-core.js";import{C as z,S as q,a as H}from"./three-extras.js";import{V as d,Q as W,D as F,B as j,a as f,M as v,P as X,W as G,N as I,C as U,b as Y}from"./physics.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class N extends l{constructor(e){super(e);const{thickness:t,length:s}=e;this.spacing=.1,this.move=!1,this.angle=0,this.length=s,this.yAxis=new d(0,1,0),this.direction=new W(0,1,0,0),this.thickness=t,this.velocity=new d(0,0,-10),this.parts=[],this.contraints=[],this.buildBody(),this.addLabel()}buildBody(){for(let e=0;e<this.length;e++){const t=new c(0,1,e*this.thickness*(1+this.spacing)),s=this.addCube(e,t);this.add(s.object),this.parts.push(s)}for(let e=0;e<this.parts.length-1;e++){const t=this.parts[e],s=this.parts[e+1];this.contraints.push(new F(s.body,t.body,this.thickness+this.spacing*2))}}addLabel(){const e=document.createElement("div");e.className="snake-label",this.label=new z(e),this.label.center.set(.5,2.5),this.parts[0].object.add(this.label)}addCube(e,t){const s=new l;if(e==0){const h=new S(this.thickness);h.scale(1,1,1.1);const m=new u({side:p,color:11206400,visible:!0}),g=new w(h,m),a=new A(9998981,6);a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.position.add(new c(0,2,0)),s.add(a),s.add(g)}else{const h=new l,m=new C(this.thickness,this.thickness,this.thickness),g=new u({side:p,color:11206400,visible:!0}),a=new w(m,g);if(h.add(a),e==this.length-1){const y=new L(this.thickness*.5,1.25,8);y.rotateX(Math.PI/2);const k=new u({side:p,color:11206400,visible:!0}),b=new w(y,k);b.position.set(a.position.x,a.position.y,a.position.z+this.thickness+this.spacing),h.add(b)}s.add(h)}s.position.set(t.x,t.y,t.z),s.castShadow=!0;const i=new d(t.x,t.y,t.z),n=new j(new d(this.thickness/2,this.thickness/2,this.thickness/2)),r=new f({mass:1,linearDamping:.1,angularDamping:1,position:i,material:new v});return r.angularVelocity.setZero(),r.addShape(n),{object:s,body:r}}setState(e){switch(e){case"ArrowLeft":this.angle=Math.PI/2;break;case"ArrowRight":this.angle=-Math.PI/2;break;case"ArrowUp":this.move=!0;break}}unsetState(e){switch(e){case"ArrowLeft":case"ArrowRight":this.angle=0;break;case"ArrowUp":this.move=!1;break}}getHead(){return this.parts[0]}getTail(){return this.parts[this.parts.length-1]}update(e){if(this.direction.setFromAxisAngle(this.yAxis,this.angle*e),this.move){const t=this.getHead(),s=this.getTail(),i=this.direction.mult(t.body.quaternion);t.body.quaternion=i,s.body.quaternion=i;let n=t.body.quaternion.vmult(this.velocity);t.body.velocity.x=n.x,t.body.velocity.z=n.z}this.parts.forEach(({object:t,body:s})=>{t.position.copy(s.position,e),t.quaternion.copy(s.quaternion,e)}),this.updateLabel()}updateLabel(){this.label.element.textContent=`Speed: ${this.getHead().body.velocity.length().toFixed(2)} m/s`}}class K extends l{constructor(e){super(e);const t=new M(100,100),s=new u({side:p,color:16777215,visible:!0}),i=new w(t,s);i.receiveShadow=!0;const n=new x(100,100);n.rotateX(-Math.PI/2),n.geometry.translate(0,-.01,0),this.add(n),this.add(i),this.groundBody=new f({mass:0,shape:new X,type:f.STATIC,material:new v}),this.groundBody.quaternion.setFromEuler(-Math.PI/2,0,0)}update(){this.position.copy(this.groundBody.position),this.quaternion.copy(this.groundBody.quaternion)}}class Q{constructor(e){this.canvasContainer=e.canvasContainer,this.debug=e.debug||!1,this.scene=new E,this.scene.background=new P("#1f2127"),this.clock=new D,this.delta=0,this.camera=new B(75,this.canvasContainer.clientWidth/this.canvasContainer.clientHeight,1,1e3),this.offset=new c,this.lookAt=new c,this.isMobile=this.detectMobileDevice(),this.touchStartX=0,this.touchStartY=0,this.touchEndX=0,this.touchEndY=0,this.initCannon(),this.addRenderers(),this.setupScene(),this.updateOverlayMessage(),this.isMobile?(this.canvasContainer.addEventListener("touchstart",t=>this.onTouchStart(t),!1),this.canvasContainer.addEventListener("touchmove",t=>this.onTouchMove(t),!1),this.canvasContainer.addEventListener("touchend",t=>this.onTouchEnd(t),!1)):(window.addEventListener("keydown",function(t){["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(t.code)>-1&&t.preventDefault()},!1),document.addEventListener("keydown",t=>this.onKeyDown(t),!1),document.addEventListener("keyup",t=>this.onKeyUp(t),!1)),window.addEventListener("resize",t=>this.onWindowResize(),!1)}detectMobileDevice(){const e="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i=window.innerWidth<=768;return e&&s||e&&i}updateOverlayMessage(){const e=document.querySelector(".game-overlay");e&&(this.isMobile?e.innerHTML=`
				<h3>3D Snake Demo</h3>
				Tap and hold to move, swipe left/right to turn
			`:e.innerHTML=`
				<h3>3D Snake Demo</h3>
				Use arrow keys 
				<img class="icon arrow-left">
				<img class="icon arrow-up">
				<img class="icon arrow-right">
				to control the snake
			`)}onTouchStart(e){e.preventDefault();const t=e.touches[0];this.touchStartX=t.clientX,this.touchStartY=t.clientY,this.snake.setState("ArrowUp")}onTouchMove(e){if(e.preventDefault(),e.touches.length===0)return;const t=e.touches[0];this.touchEndX=t.clientX,this.touchEndY=t.clientY;const s=this.touchEndX-this.touchStartX,i=this.touchEndY-this.touchStartY;Math.abs(s)>Math.abs(i)&&(s>40?this.snake.setState("ArrowRight"):s<-40?this.snake.setState("ArrowLeft"):(this.snake.unsetState("ArrowLeft"),this.snake.unsetState("ArrowRight")))}onTouchEnd(e){e.preventDefault(),this.snake.unsetState("ArrowLeft"),this.snake.unsetState("ArrowRight"),this.snake.unsetState("ArrowUp")}initCannon(){const e=new G;e.gravity.set(0,-9.81,0),e.broadphase=new I,e.solver.iterations=10,this.world=e,this.cannonDebugger=new U(this.scene,this.world)}setupScene(){this.addPlane(),this.addSnake(),this.addLights()}addRenderers(){this.stats=new q,this.stats.showPanel(0),this.stats.domElement.style.cssText="position: absolute; right: 20px; opacity: 0.9; z-index: 999",this.renderer=new R({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=T,this.renderer.setSize(this.canvasContainer.clientWidth,this.canvasContainer.clientHeight),this.canvasContainer.appendChild(this.stats.dom),this.canvasContainer.appendChild(this.renderer.domElement),this.labelRenderer=new H,this.labelRenderer.setSize(this.canvasContainer.clientWidth,this.canvasContainer.clientHeight),this.labelRenderer.domElement.classList.add("game-css"),this.canvasContainer.appendChild(this.labelRenderer.domElement)}addLights(){this.scene.add(new O(11447968,.1))}addSnake(){this.snake=new N({thickness:.5,length:5}),this.snake.parts.forEach(({body:e})=>{this.world.addBody(e),this.world.addContactMaterial(new Y(e.material,this.plane.groundBody.material,{friction:.02}))}),this.snake.contraints.forEach(e=>{this.world.addConstraint(e)}),this.scene.add(this.snake)}addPlane(){this.plane=new K,this.scene.add(this.plane),this.world.addBody(this.plane.groundBody)}onWindowResize(){this.camera.aspect=this.canvasContainer.clientWidth/this.canvasContainer.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.canvasContainer.clientWidth,this.canvasContainer.clientHeight),this.labelRenderer.setSize(this.canvasContainer.clientWidth,this.canvasContainer.clientHeight),this.render()}run(){requestAnimationFrame(()=>this.run()),this.delta=this.clock.getDelta(),this.updateCamera(),this.updatePhysics(),this.render(),this.stats.update()}onKeyDown(e){this.snake.setState(e.code)}onKeyUp(e){this.snake.unsetState(e.code)}idealOffset(e){const t=new c(0,5,8);return t.applyQuaternion(e.object.quaternion),t.add(e.object.position),t}idealLookAt(e){const t=new c(0,0,-10);return t.applyQuaternion(e.object.quaternion),t.add(e.object.position),t}updateCamera(){const e=this.snake.getHead(),t=this.idealOffset(e),s=this.idealLookAt(e);this.offset=this.offset.lerp(t,this.delta*4),this.lookAt=this.lookAt.lerp(s,this.delta*4),this.camera.lookAt(this.lookAt),this.camera.position.copy(this.offset)}updatePhysics(){this.world.fixedStep(),this.snake.update(this.delta),this.plane.update(this.delta),this.debug&&this.cannonDebugger.update()}render(){this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera)}}window.onload=()=>{const o=document.getElementById("intro-canvas");if(!o)return;o.focus(),new Q({canvasContainer:o,debug:!1}).run()};window.onClickNavBarItem=o=>{const e=document.getElementsByClassName("active");for(let t of e)t.classList.remove("active");o.classList.add("active")};
